"use strict";function getReviewUrl(){var e=chrome.runtime.id;switch(e){case EDGE_PRODUCTION_ID:return"https://microsoftedge.microsoft.com/addons/detail/j2team-security/nckdadddljhnbimojbhccmjhckkfaang";case CHROME_PRODUCTION_ID:return"https://chrome.google.com/webstore/detail/"+e+"/reviews"}return"https://j2team.dev/"}function _log(e,t,n){if(CONFIG.debug&&"undefined"!=typeof e&&e.length>0)if("undefined"!=typeof chrome&&"notifications"in chrome&&"undefined"!=typeof n&&n){var o=chrome.extension.getURL("images/juno_okyo.png"),a="log_"+(new Date).getTime();chrome.notifications.create(a,{type:"basic",iconUrl:o,title:"[Debug] "+chrome.i18n.getMessage("appName"),message:e,isClickable:!0,requireInteraction:!0},function(e){chrome.notifications.onClicked.addListener(function(e){e===a&&chrome.notifications.clear(e)})})}else if("undefined"!=typeof console)try{console[t.toLowerCase()](e)}catch(s){console.log(e)}}function trackPageView(e){try{ga("send","pageview",e)}catch(t){_log(t.message,"error")}}function trackEvent(e,t,n){try{"undefined"==typeof n||null===n||""===n?ga("send","event",e,t):ga("send","event",e,t,n)}catch(o){_log(o.message,"error")}}function _TabCreateOrFocus(e,t){if(!("undefined"!=typeof chrome&&"tabs"in chrome))return!1;var n=chrome.tabs;n.query({url:e},function(o){o.length>0?n.update(o[0].id,{active:!0},function(e){"function"==typeof t&&t()}):n.query({url:"chrome://newtab/*",status:"complete"},function(o){o.length>0?n.update(o[0].id,{url:e,active:!0},function(e){"function"==typeof t&&t()}):n.create({url:e,active:!0},function(e){"function"==typeof t&&t()})})})}function forceHTTPS(e){try{var t=new URL(e);return t.protocol="https:",t.href}catch(n){return _log(n.message,"error"),e.replace("http:","https:")}}function JSONtoQS(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))){if("string"!=typeof e)return _log("Invalid variable type.","error"),!1;try{e=JSON.parse(e)}catch(t){return _log(t.message,"error"),!1}}var n=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");return n}var CHROME_PRODUCTION_ID="hmlcjjclebjnfohgmgikjfnbmfkigocc",EDGE_PRODUCTION_ID="nckdadddljhnbimojbhccmjhckkfaang",IS_PRODUCTION=[CHROME_PRODUCTION_ID,EDGE_PRODUCTION_ID].includes(chrome.runtime.id),CONFIG={debug:!IS_PRODUCTION,runtime_ids:[CHROME_PRODUCTION_ID,EDGE_PRODUCTION_ID],admin:"100003880469096",google_analytics:"UA-45794712-21",show_update_notification:!0,url:{premium_login:"https://j2team.org/",premium_upgrade:"https://j2team.org/",database:"https://j2team.github.io/extensions/j2team-security/db.json",changelog:"https://j2team.org/extension/changelog",report:"https://github.com/J2TEAM/J2TeaM-Security/issues/new",faq:"https://www.junookyo.com/2016/10/juno-okyo-extension-faq.html?utm_source=extension&utm_medium=j2team_security",donate:"https://j2team.org/buy-me-a-coffee",review:getReviewUrl(),welcome:"https://j2team.org/thank-you",facebook:"https://www.facebook.com/"}};!function(e,t,n,o,a,s,r){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,s=t.createElement(n),r=t.getElementsByTagName(n)[0],s.async=1,s.src=o,r.parentNode.insertBefore(s,r)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create",CONFIG.google_analytics,"auto"),ga("set","checkProtocolTask",null);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"function"!=typeof String.prototype.includes&&(String.prototype.includes=function(e){return this.indexOf(e)>-1}),function(e){function t(t){return t.requestHeaders.push({name:"J2TEAM-Security-ID",value:e.runtime.id}),t.requestHeaders.push({name:"J2TEAM-Security-Version",value:e.runtime.getManifest().version}),{requestHeaders:t.requestHeaders}}function n(e){if(q){for(var t=0,n=0,o="https://"+new URL(e.url).hostname,a=0,s=e.requestHeaders.length;a<s;++a){var r=e.requestHeaders[a].name.toLowerCase();if("referer"===r&&(t=1),"origin"===r&&(n=1),"origin"===r||"referer"===r){e.requestHeaders[a].value=o;break}}return 0===t&&e.requestHeaders.push({name:"Referer",value:o}),0===n&&e.requestHeaders.push({name:"Origin",value:o}),{requestHeaders:e.requestHeaders}}}function o(e,t){q=!0;var n="fb_dtsg="+encodeURIComponent(t);return n+=e.includes("variables")?"&"+e:"&q="+encodeURIComponent(e),fetch("https://www.facebook.com/api/graphql/",{body:n,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"include"}).then(function(e){return e.json()}).then(function(e){return q=!1,e})["catch"](function(e){return{error:!0}})}function a(e,t,n){try{return e.split(t)[1].split(n)[0]}catch(o){return!1}}function s(t){if("function"==typeof t){var n=3e5;if(k.facebook_init&&k.facebook_init_cache_time&&(new Date).getTime()-k.facebook_init_cache_time<n)return void t(k.facebook_init.user,k.facebook_init.token);try{fetch("https://mbasic.facebook.com/help/229715077154790",{credentials:"include"}).then(function(e){return e.text()}).then(function(n){if(n.includes("fast_switch_site")){var o=/"(https:\/\/m\.facebook\.com\/a\/preferences\.php\?fast_switch_site[a-zA-Z0-9&=\-_%.;]+)"/,r=o.exec(n);null!==r&&fetch(r[1],{credentials:"include"}).then(function(e){return e.text()}).then(function(e){s(t)})}else e.cookies.get({url:"https://www.facebook.com",name:"c_user"},function(e){if(null!==e){var o=e.value,s=a(n,'name="fb_dtsg" value="','" ');k.facebook_init={user:o,token:s},k.facebook_init_cache_time=(new Date).getTime(),t(o,s)}})})}catch(o){_log(o.message,"error")}}}function r(e){var t=3e5;return k.facebook_auth&&k.facebook_auth_cache_time&&(new Date).getTime()-k.facebook_auth_cache_time<t?void e(k.facebook_auth):(q=!0,void s(function(t,n){fetch("https://business.facebook.com/creatorstudio/home",{method:"GET",credentials:"include"}).then(function(e){return e.text()}).then(function(o){q=!1;var a=o.match(/MediaManagerStatics",\[\],{"accessToken":"(.+?)"/);if(null!==a){var s={id:t,csrf_token:n,access_token:a[1]};k.facebook_auth=s,k.facebook_auth_cache_time=(new Date).getTime(),e(s)}})["catch"](function(t){e({error:!0,id:null,csrf_token:null,access_token:null})})}))}function c(t){t=t.toLowerCase(),e.tabs.query({url:"https://*."+t+".com/*"},function(t){t.map(function(t){e.tabs.sendMessage(t.id,{cmd:"update_custom_css"})})})}function i(){v.includes("extraHeaders")||(v=v.concat(["extraHeaders"]))}function u(t){e.storage.sync.get({blocklist:null},function(e){null!==e.blocklist&&(j=e.blocklist.split("\n").filter(function(e){return e.startsWith("http:")||e.startsWith("https:")||e.startsWith("*://")}),"function"==typeof t&&t(j))})}function l(e){return{redirectUrl:I}}function p(e,t,n){var o=new FormData;o.append("fb_dtsg",n),o.append("confirmed",1),o.append("__user",t),o.append("__a",1),q=!0,fetch(CONFIG.url.facebook+"ajax/groups/membership/leave.php?group_id="+e+"&dpr=1",{method:"POST",credentials:"include",body:o}).then(function(){q=!1})}function d(e,t,n){var o=new FormData;o.append("fbpage_id",e),o.append("add",!1),o.append("reload",!1),o.append("fan_origin","page_timeline"),o.append("__user",t),o.append("__a",1),o.append("fb_dtsg",n),q=!0,fetch(CONFIG.url.facebook+"ajax/pages/fan_status.php?dpr=1",{method:"POST",credentials:"include",body:o}).then(function(){q=!1})}function f(e,t,n){var o=new FormData;o.append("uid",e),o.append("unref","bd_friends_tab"),o.append("floc","friends_tab"),o.append("__user",t),o.append("__a",1),o.append("fb_dtsg",n),q=!0,fetch(CONFIG.url.facebook+"ajax/profile/removefriendconfirm.php?dpr=1",{method:"POST",credentials:"include",body:o}).then(function(){q=!1})}function m(e,t,n,o,a,s){q=!0;var r=new FormData;r.append("is_explicit_place",!1),r.append("privacyx",t),r.append("xhpc_message",e),r.append("xhpc_message_text",e),r.append("xhpc_composerid","juno_okyo"),r.append("__user",o),r.append("__a",1),r.append("fb_dtsg",a),"j2team"===n?r.append("composertags_place_name","J2TEAM"):(r.append("composertags_city",n),r.append("composertags_place",n)),fetch(CONFIG.url.facebook+"ajax/updatestatus.php?av="+o+"&dpr=1&juno_okyo=1",{method:"POST",credentials:"include",body:r}).then(function(e){return q=!1,e.text()}).then(function(e){if("function"==typeof s)try{var t=JSON.parse(e.substr(9)),n=t.jsmods.require[1][3][1].contentID;s(n)}catch(o){_log(o.message,"error")}})}function g(){return Math.floor(1e14*Math.random()).toString().substr(0,12)}function h(){e.storage.sync.set({lastCheckPremiumAt:Date.now()}),e.notifications.create("upgrade",{type:"basic",iconUrl:b,title:e.i18n.getMessage("notificationUpgradeTitle"),message:e.i18n.getMessage("notificationUpgradeMessage"),requireInteraction:!0,buttons:[{title:e.i18n.getMessage("notificationUpgradeButton")}]},function(t){e.notifications.onClicked.addListener(function(n){n===t&&(e.tabs.create({url:"https://j2team.org/auth"}),e.notifications.clear(t))}),e.notifications.onButtonClicked.addListener(function(n){n===t&&(e.tabs.create({url:"https://j2team.org/auth"}),e.notifications.clear(t))})})}function _(){e.storage.sync.get("lastCheckPremiumAt",function(t){if(t.lastCheckPremiumAt){var n=Date.now()-t.lastCheckPremiumAt;if(n<18144e5)return}e.cookies.get({url:"https://www.facebook.com",name:"c_user"},function(t){if(t){var n=t.value,o=CONFIG.debug?"http://j2team.test/extension/auth/check":"https://j2team.dev/extension/auth/check";fetch(o,{headers:{"x-auth-uid":n}}).then(function(e){return 204===e.status}).then(function(t){t?e.storage.sync.set({account_type:"premium"}):h()})["catch"](function(e){h()})}})})}if("undefined"==typeof CONFIG||!("debug"in CONFIG))throw new Error("Access denied. Homepage: https://www.junookyo.com/");var b=e.extension.getURL("images/juno_okyo.png"),k={};e.runtime.onInstalled.addListener(function(t){var n=t.reason.toLowerCase();switch(n){case e.runtime.OnInstalledReason.INSTALL:_TabCreateOrFocus(CONFIG.url.welcome),e.storage.sync.set({install_date:(new Date).getTime()});break;case e.runtime.OnInstalledReason.UPDATE:CONFIG.show_update_notification&&e.storage.sync.get({show_update_notification:!0,install_date:null},function(t){if(null===t.install_date&&e.storage.sync.set({install_date:(new Date).getTime()}),t.show_update_notification){var n=e.i18n.getMessage("updateMessage").replace("{appName}",e.i18n.getMessage("appName")).replace("{appVersion}",e.runtime.getManifest().version);e.notifications.create("extension_updated",{type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:n,isClickable:!0},function(t){"extension_updated"===t&&e.notifications.onClicked.addListener(function(n){n===t&&_TabCreateOrFocus(CONFIG.url.changelog,function(){e.notifications.clear(n)})})})}})}}),e.browserAction.onClicked.addListener(function(){_TabCreateOrFocus(e.extension.getURL("options.html"))});var y=[CONFIG.admin],w={};e.storage.sync.get(function(t){function n(e){try{var t=new DataView(e);return new TextDecoder("utf-8").decode(t)}catch(n){return _log(n.message,"error"),null}}function o(e,t,n){q=!0;var o=new FormData;o.append("ids["+e+"]",!0),o.append("__user",t),o.append("__a",1),o.append("fb_dtsg",n),fetch(CONFIG.url.facebook+"ajax/mercury/change_read_status.php?dpr=1&juno_okyo=1",{method:"POST",credentials:"include",body:o}).then(function(){q=!1})}w=t,y=y.concat(t.seenWhiteList),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:w.blockTypingComment}},{urls:["https://*.facebook.com/ufi/typing/*"],types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){try{var t=e.requestBody.formData,n=t.__user[0],o=t.to;if(n!==CONFIG.admin&&o&&y.includes(o[0]))return{cancel:!1}}catch(a){_log(a.message,"error")}return{cancel:w.blockTypingChat}},{urls:["https://*.facebook.com/ajax/messaging/typ.php*","https://*.messenger.com/ajax/messaging/typ.php*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.storage.onChanged.addListener(function(e,t){"sync"===t&&(Object.keys(e).map(function(t){w[t]=e[t].newValue}),e.seenWhiteList&&(y=e.seenWhiteList.newValue.concat([CONFIG.admin])))}),e.webRequest.onBeforeRequest.addListener(function(e){if("GET"===e.method&&w.removeFbclid){var t=new URL(e.url);return t.searchParams.has("fbclid")?(t.searchParams["delete"]("fbclid"),{redirectUrl:t.href}):void 0}},{urls:["*://*/*fbclid=*"],types:["main_frame"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){if(e.url.endsWith("juno_okyo=1")||e.url.includes("juno_okyo=1"))return{cancel:!1};if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,o=n(t);if(null!==o&&o.includes("&")){var a=o.split("&"),s=a.filter(function(e){return e.startsWith("__user=")}),r=a.filter(function(e){return e.startsWith("ids[")});if(r.length>0&&s.length>0){var c=s[0].substr(7),i=r[0].split("[")[1].split("]")[0];if(c!==CONFIG.admin&&y.includes(i))return{cancel:!1}}}return{cancel:w.blockSeen}}},{urls:["https://*.facebook.com/ajax/mercury/change_read_status.php*","https://*.messenger.com/ajax/mercury/change_read_status.php*","https://*.facebook.com/ajax/mercury/delivery_receipts.php*","https://*.messenger.com/ajax/mercury/delivery_receipts.php*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onBeforeRequest.addListener(function(e){if("POST"===e.method)if(e.url.includes("/graphqlbatch")){if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,o=n(t);if(null!==o&&o.includes("1644150182303893")&&o.includes("last_message_seen_id"))return{cancel:w.blockSeenStoryFB}}}else if(e.requestBody.formData){var a=["1717353725012289","3382286541796833","2434375709941844"],s=["MessengerMarkReadMutation","storiesUpdateSeenStateMutation"];if(e.requestBody.formData.doc_id&&a.includes(e.requestBody.formData.doc_id[0])||e.requestBody.formData&&e.requestBody.formData.fb_api_req_friendly_name&&s.includes(e.requestBody.formData.fb_api_req_friendly_name[0]))return{cancel:w.blockSeenStoryFB};if(e.requestBody.formData.fb_api_req_friendly_name&&e.requestBody.formData.fb_api_req_friendly_name.includes("CometNewsFeedPaginationQuery"))return{cancel:w.stopFacebookTimeline}}},{urls:["https://*.facebook.com/api/graphqlbatch/*","https://*.facebook.com/api/graphql/*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onBeforeRequest.addListener(function(e){if("POST"===e.method)return{cancel:w.blockSeenStoryInstagram}},{urls:["https://*.instagram.com/*/reel/seen*"],types:["xmlhttprequest"]},["blocking"]);for(var a=["https://edge-chat.facebook.com/pull?*&idle=*","https://edge-chat.facebook.com/active_ping?*&state=*","https://edge-chat.messenger.com/pull?*&idle=*","https://edge-chat.messenger.com/active_ping?*&state=*"],s=0;s<10;s++)a.push("https://"+s+"-edge-chat.facebook.com/pull?*&idle=*"),a.push("https://"+s+"-edge-chat.facebook.com/active_ping?*&state=*"),a.push("https://"+s+"-edge-chat.messenger.com/pull?*&idle=*"),a.push("https://"+s+"-edge-chat.messenger.com/active_ping?*&state=*");e.webRequest.onBeforeRequest.addListener(function(e){if(w.hideActiveTime)try{var t=new URL(e.url);if((t.searchParams.has("state")||t.searchParams.has("idle"))&&!t.searchParams.has("juno_okyo"))return t.searchParams.has("idle")&&t.searchParams.set("idle",9e3),t.searchParams.set("juno_okyo",1),t.searchParams["delete"]("state"),{redirectUrl:t.href||t.toString()}}catch(n){_log(n.message,"error")}},{urls:a,types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:w.blockFacebookPixel}},{urls:["https://connect.facebook.net/*/fbevents.js*"],types:["script"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:w.stopFacebookTimeline}},{urls:["https://*.facebook.com/ajax/pagelet/generic.php/LitestandTailLoadPagelet*","https://*.facebook.com/ajax/pagelet/generic.php/LitestandMoreStoriesPagelet*","https://*.facebook.com/stories.php?aftercursor=*"],types:["sub_frame","xmlhttprequest"]},["blocking"]),fetch("https://j2team.github.io/extensions/j2team-security/blacklist.json?v="+(new Date).getTime()).then(function(e){return e.json()}).then(function(t){t.miners&&e.webRequest.onBeforeRequest.addListener(function(t){return w.blockCryptocurrencyMining?(e.notifications.create(null,{type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("notificationCryptocurrencyMining")}),{cancel:!0}):{cancel:!1}},{urls:t.miners,types:["script","xmlhttprequest","websocket"]},["blocking"])}),e.webRequest.onBeforeRequest.addListener(function(t){if(t.url.endsWith("juno_okyo=1")||t.url.includes("juno_okyo=1"))return{cancel:!1};if(w.blockFacebookAutoCheckin&&"undefined"!=typeof t.requestBody.raw){var o=t.requestBody.raw[0].bytes,a=n(o).split("&");if(a.length>0){for(var s=!1,r=!1,c=0,i=a.length;c<i;++c){var u=a[c];(u.startsWith("composertags_city=")||u.startsWith("composertags_place="))&&(s=!0),"is_explicit_place=true"===u&&(r=!0)}if(s&&!r)return e.notifications.create({type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("facebookCheckinBlockedNotify")}),{cancel:!0}}}},{urls:["https://*.facebook.com/ajax/updatestatus.php*","https://*.facebook.com/composerx/intercept/status/*","https://*.facebook.com/media/upload/photos/composer/*"],types:["xmlhttprequest"]},["blocking","requestBody"]);var r={},c={id:null,fb_dtsg:null};e.webRequest.onBeforeRequest.addListener(function(e){if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,o=n(t).split("&");if(o.length>0){for(var a=null,s=0,i=o.length;s<i&&(null===a||null===c.id||null===c.fb_dtsg);++s){var u=o[s];u.startsWith("other_user_fbid=")?a=u.substr(16):u.startsWith("__user=")?c.id=u.substr(7):u.startsWith("fb_dtsg=")&&(c.fb_dtsg=decodeURIComponent(u.substr(8)))}null!==a&&(r["request_"+e.requestId]=a)}}},{urls:["https://*.facebook.com/messaging/send/*","https://*.messenger.com/messaging/send/*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onCompleted.addListener(function(e){"post"===e.method.toLowerCase()&&200===e.statusCode&&"undefined"!=typeof r["request_"+e.requestId]&&o(r["request_"+e.requestId],c.id,c.fb_dtsg)},{urls:["https://*.facebook.com/messaging/send/*","https://*.messenger.com/messaging/send/*"],types:["xmlhttprequest"]})}),e.webRequest.onBeforeRequest.addListener(function(t){try{var n=new URL(t.url),o=new URL(n.searchParams.get("u"));if(null!==o){var a=o.pathname.split("/"),s=a[a.length-1];if(/photos?_[0-9]+\.svg|videos?_[0-9]+\.(html|zip|rar|gz|7z|exe)?/i.test(s))return e.notifications.create(null,{type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("blockMalwareFileNotify")}),{cancel:!0}}}catch(r){_log(r.message,"error")}},{urls:["https://l.facebook.com/l.php*"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){return{redirectUrl:forceHTTPS(e.url)}},{urls:["http://*.blogspot.com/*"]},["blocking"]);var v=["blocking","requestHeaders"],x=["https://*.j2team.org/*","https://*.giamgia.to/*"];CONFIG.debug&&x.push("http://localhost:3000/*"),e.webRequest.onBeforeSendHeaders.addListener(t,{urls:x},v),i();var q=!1;e.webRequest.onBeforeSendHeaders.addListener(n,{urls:["https://*.facebook.com/*/dialog/oauth/confirm*","https://*.facebook.com/ajax/groups/membership/leave.php*","https://*.facebook.com/ajax/mercury/change_read_status.php*","https://*.facebook.com/ajax/mercury/search_context.php*","https://*.facebook.com/ajax/mercury/threadlist_info.php*","https://*.facebook.com/ajax/pages/fan_status.php*","https://*.facebook.com/ajax/profile/removefriendconfirm.php*","https://*.facebook.com/ajax/updatestatus.php*","https://*.facebook.com/api/graphql/*","https://*.facebook.com/api/graphqlbatch/*","https://*.facebook.com/composer/ocelot/async_loader/*","https://*.facebook.com/messaging/save_thread_color/*","https://*.messenger.com/ajax/mercury/change_read_status.php*","https://*.messenger.com/ajax/mercury/search_context.php*","https://*.messenger.com/ajax/mercury/threadlist_info.php*","https://*.messenger.com/api/graphqlbatch/*"]},v);var j=[],M=[];u(null);var I="data:text/plain,"+encodeURIComponent("Blocked by J2TEAM Security");e.runtime.onMessage.addListener(function(t,n,a){var i=t.cmd.toLowerCase();switch(i){case"block_page":e.storage.sync.get({realtime:!0},function(o){if(o.realtime){var a=n.tab,s=a.url;e.tabs.update(a.id,{url:e.extension.getURL("blocked.html?url="+s),active:!0,highlighted:!0},function(){"miner"===t.type?e.notifications.create(null,{type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("notificationCryptocurrencyMining")}):e.notifications.create(null,{type:"basic",iconUrl:b,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("blockedUrl")+s})})}});break;case"update_options":w=t.options,trackEvent("options","update");break;case"track_page_view":trackPageView(t.path);break;case"track_click_rate":trackEvent("button","click","rate");break;case"update_custom_css":c(t.website);break;case"update_custom_blocklist":e.webRequest.onBeforeRequest.hasListener(l)&&e.webRequest.onBeforeRequest.removeListener(l),u(function(t){try{e.webRequest.onBeforeRequest.addListener(l,{urls:M.concat(t)},["blocking"])}catch(n){_log(n.message,"error"),e.webRequest.onBeforeRequest.addListener(l,{urls:M},["blocking"])}});break;case"facebook_authentication":r(function(t){e.tabs.sendMessage(n.tab.id,{cmd:"facebook_authentication_response",data:t.access_token,user:{id:t.id,csrf_token:t.csrf_token}})});break;case"facebook_init":q=!0,s(function(t,o){q=!1,e.tabs.sendMessage(n.tab.id,{cmd:"facebook_init_response",data:o,uid:t})});break;case"update_fb_origin":q=t.enable||!1,a({success:!0});break;case"j2team_verify":r(function(t){fetch("https://graph.facebook.com/fql?q=SELECT%20uid%20FROM%20group_member%20WHERE%20gid=364997627165697%20AND%20uid=me()&access_token="+t.access_token).then(function(e){return e.json()}).then(function(t){e.tabs.sendMessage(n.tab.id,{cmd:"j2team_verify_response",success:t.data&&t.data.length>0})})});break;case"kount":s(function(t,a){o("viewer(){message_threads{count,nodes{customization_info{emoji,outgoing_bubble_color,participant_customizations{participant_id,nickname}},all_participants{nodes{messaging_actor{name,id,profile_picture}}},thread_type,name,messages_count,image,id}}}",a).then(function(o){if(o.viewer&&o.viewer.message_threads.nodes.length>0){var a=o.viewer.message_threads.nodes;a=a.filter(function(e){if("ONE_TO_ONE"===e.thread_type){var t=e.all_participants.nodes;return 2===t.length&&("Facebook User"!==t[0].messaging_actor.name&&"Facebook User"!==t[1].messaging_actor.name)}return!1}),a.sort(function(e,t){return t.messages_count-e.messages_count});var s=a.slice(0,15),r=[];s.map(function(e){var n=e.all_participants.nodes,o=n[0].id===t?n[1].messaging_actor:n[0].messaging_actor;r.push({count:e.messages_count,name:e.name,user:[o]})}),e.tabs.sendMessage(n.tab.id,{cmd:"kount_response",data:{threads:r,total_threads:o.viewer.message_threads.count}})}})});break;case"avatar_guard":s(function(a,s){o('variables={"0":{"is_shielded":'+t.value+',"actor_id":"'+a+'","client_mutation_id":"J2TEAM"}}&doc_id=1477043292367183',s).then(function(o){var a=!1;o.data&&o.data.is_shielded_set&&(a=!0),e.tabs.sendMessage(n.tab.id,{cmd:"avatar_guard_response",success:a,state:t.value})})});break;case"get_user_feed":!function(t){var a=t.authentication,s="node("+a.uid+"){timeline_feed_units.first(500)";t.cursor&&(s+=".after("+t.cursor+")"),s+="{page_info,edges{node{id,creation_time,can_viewer_edit_post_privacy,message{text},privacy_scope{type},feedback{reactors{count},comments{count},reshares{count}}}}}}",o(s,a.csrf_token).then(function(t){e.tabs.sendMessage(n.tab.id,{cmd:"get_user_feed_response",data:t[a.uid]})})}(t);break;case"set_status_privacy":!function(t){var a=t.authentication;o('variables={"0":{"privacy":{"base_state":"'+t.privacy+'"},"node_id":"'+t.postId+'","client_mutation_id":1,"actor_id":"'+a.uid+'"}}&doc_id=2048529131862025',a.csrf_token).then(function(o){o.data?e.tabs.sendMessage(n.tab.id,{cmd:"set_status_privacy_response",data:t.postId,success:!0}):e.tabs.sendMessage(n.tab.id,{cmd:"set_status_privacy_response",success:!1})})}(t)}}),e.storage.sync.get({onlinedb:!0},function(t){t.onlinedb&&fetch(CONFIG.url.database).then(function(e){return 200===e.status&&e.ok?e.json():null}).then(function(t){if(null!==t&&(t.map(function(e){M.push("*://*."+e.domain+"/*")}),M.length>0)){j.length>0&&(M=M.concat(j));try{e.webRequest.onBeforeRequest.addListener(l,{urls:M},["blocking"])}catch(n){_log(n.message,"error")}}})}),e.commands.onCommand.addListener(function(t){t=t.toLowerCase();var n=!1;switch(t){case"toggle_block_seen":n=!w.blockSeen,e.storage.sync.set({blockSeen:n},function(){w.blockSeen=n});break;case"toggle_block_typing":n=!w.blockTypingChat,e.storage.sync.set({blockTypingChat:n},function(){w.blockTypingChat=n})}});var C=null,R=null;e.runtime.onMessageExternal.addListener(function(t,n,a){var c=new URL(n.url).hostname;if(CONFIG.debug||c.includes("j2team.org")&&c.includes("giamgia.to")){var i=t.cmd.toLowerCase();switch(i){case"facebook_create_cache":s(function(e,t){C=e,R=t});break;case"facebook_leave_group":null===C||null===R?s(function(e,n){C=e,R=n,p(t.group_id,e,n)}):p(t.group_id,C,R);break;case"facebook_unlike_page":null===C||null===R?s(function(e,n){C=e,R=n,d(t.page_id,e,n)}):d(t.page_id,C,R);break;case"facebook_unfriend":null===C||null===R?s(function(e,n){C=e,R=n,f(t.friend_id,e,n)}):f(t.friend_id,C,R);break;case"facebook_update_status":if(t.status&&t.privacy&&t.location&&t.status.length>0){var u=function(t){e.tabs.executeScript(n.tab.id,{code:"window.postMessage({sender: 'juno_okyo', success: true}, '"+n.url+"');"},function(){_TabCreateOrFocus(""+CONFIG.url.facebook+t)})};e.cookies.get({url:"https://*.facebook.com",name:"c_user"},function(e){null!==e&&(null===C||null===R||C!==e.value?s(function(e,n){C=e,R=n,m(t.status,t.privacy,t.location,e,n,u)}):m(t.status,t.privacy,t.location,C,R,u))})}break;case"update_fb_origin":q=t.enable||!1,a({success:!0});break;case"download_video":if(!t.endpoint)break;r(function(e){fetch(t.endpoint.replace("__VIDEO_ID__",t.videoId).replace("__TOKEN__",e.access_token)).then(function(e){return e.json()}).then(function(e){a(e)})["catch"](function(e){a({success:!1,error:e.message})})});break;case"load_friends":if(!t.endpoint)break;r(function(e){fetch(t.endpoint.replace("__UID__",e.id).replace("__DTSG__",encodeURIComponent(e.csrf_token))).then(function(e){return e.text()}).then(function(e){return JSON.parse(e.substr(9))}).then(function(t){a({data:t,id:e.id})})});break;case"request_graph_api":if(!t.endpoint)break;r(function(e){fetch(t.endpoint.replace("__TOKEN__",e.access_token)).then(function(e){return e.json()}).then(a)["catch"](function(e){a({success:!1,error:!0,error_message:e.message})})});break;case"kount":s(function(e,t){o("viewer(){message_threads{count,nodes{customization_info{emoji,outgoing_bubble_color,participant_customizations{participant_id,nickname}},all_participants{nodes{messaging_actor{name,id,profile_picture}}},thread_type,name,messages_count,image,id}}}",t).then(function(e){a(e)})});break;case"web_auth":e.cookies.get({url:"https://www.facebook.com",name:"c_user"},function(e){if(!e)return void a({uid:null});var n=e.value;if(t.uid_only)return void a({uid:n});var o=g(),s=window.btoa(""+o+n.split("").reverse().join("")),r=CONFIG.debug?"http://j2team.test/extension/auth":"https://j2team.dev/extension/auth";fetch(r,{headers:{"j2team-security-auth":s}}).then(function(e){return e.json()}).then(function(e){return a({uid:n,data:e})})["catch"](function(e){a({uid:n})})});break;case"request_graphql":s(function(e,n){o(t.query,n).then(a)});break;case"request_http":fetch(t.resource,t.init).then(function(e){return t.json?e.json():e.text()}).then(a)["catch"](function(e){a({success:!1,error:e.message})});break;case"get_options":e.storage.sync.get(null,a);break;case"set_options":e.storage.sync.set(t.options,a);break;case"create_tab":_TabCreateOrFocus(t.url);break;case"open_extension_page":_TabCreateOrFocus(e.extension.getURL(t.path));break;case"create_notification":e.notifications.create(t.id,t.options,a)}}}),e.storage.sync.get("account_type",function(t){"premium"!==t.account_type&&(e.alarms.create("check_premium",{delayInMinutes:5}),e.alarms.onAlarm.addListener(function(e){"check_premium"===e.name&&_()}))}),CONFIG.debug||e.runtime.setUninstallURL("https://j2team.org/extension/feedback"),trackPageView("/background.html")}(chrome),function(e,t){function n(t){return e.i18n.getMessage("context_menu_"+t)}function o(t){return t.contexts=["page","link","selection"],e.contextMenus.create(t)}function a(e,t){var n;try{n=e.linkUrl||e.selectionText||e.pageUrl}catch(o){n=t.url,_log(o.message,"error")}if("string"==typeof e.selectionText){n.startsWith("http")||(n="http://"+n);try{var a=new URL(n).hostname;a.includes(".")||"localhost"===a||(n=e.pageUrl||t.url)}catch(o){n=e.pageUrl||t.url,_log(o.message,"error")}}return n}function s(e){if("string"!=typeof e||e.startsWith("chrome:")||e.startsWith("file:")||e.startsWith("about:"))return!1;if(e.includes("/safebrowsing/report"))return!1;try{var t=new URL(e),n=t.protocol;if("chrome:"===n||"file:"===n||"about:"===n)return!1;var o=t.hostname,a=!0;return l.forEach(function(e){(o===e||o.includes(e))&&(a=!1)}),a}catch(s){return!1}}function r(t){var n=void 0!==t&&s(t);e.contextMenus.update("report_abuse",{enabled:n})}function c(e,n){var o=a(e,n),r=e.menuItemId;if(s(o)){switch(o=encodeURIComponent(o),r){case"report_phishing":t("https://www.google.com/safebrowsing/report_phish/?url="+o+"&utm_source=extension&utm_medium=j2team_security");break;case"report_badware":t("https://www.google.com/safebrowsing/report_badware/?url="+o+"&utm_source=extension&utm_medium=j2team_security");break;case"report_webspam":t("https://www.google.com/webmasters/tools/spamreportform?spamurl="+o+"&utm_source=extension&utm_medium=j2team_security");break;default:return}trackEvent("button","click",r)}}function i(e){return/^https?:\/\/shopee\.vn\/.+-i\.[0-9]+\.[0-9]+/.test(e)||e.startsWith("https://shopee.vn/product/")}function u(n){i(n)?t(n.replace("shopee.vn","giamgia.to")):e.notifications.create({type:"basic",iconUrl:e.extension.getURL("images/juno_okyo.png"),title:e.i18n.getMessage("appName"),message:"Không phải một liên kết sản phẩm Shopee hợp lệ!"})}if("undefined"==typeof CONFIG||!("debug"in CONFIG))throw new Error("Access denied. Homepage: https://www.junookyo.com/");var l=["junookyo.com",".junookyo.com","junookyo.blogspot.com","junookyo.blogspot.","junookyo.xyz",".junookyo.xyz","j2team.dev","j2team.org","giamgia.to"];e.contextMenus.create({title:e.i18n.getMessage("tools"),contexts:["browser_action"],id:"tools"}),e.contextMenus.create({title:e.i18n.getMessage("darkThemeEditor"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("dark-theme-editor.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("customBlockList"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("custom-block-list.html"))}}),e.contextMenus.create({title:"Facebook Seen Whitelist",contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-seen-whitelist.html"))}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"tools"}),e.contextMenus.create({title:e.i18n.getMessage("facebookSecurityTester"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-security-tester.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebookKount"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-kount.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebook_messenger_history"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-messenger-history.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebook_avatar_guard"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-avatar-guard.html"));
}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_help"),contexts:["browser_action"],id:"help"}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_change_language"),contexts:["browser_action"],parentId:"help",onclick:function(){t("chrome://settings/languages",function(){trackEvent("button","click","change_language")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_change_hotkey"),contexts:["browser_action"],parentId:"help",onclick:function(){t("chrome://extensions/configureCommands",function(){trackEvent("button","click","change_hotkey")})}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"help"}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_report_suggest"),contexts:["browser_action"],parentId:"help",onclick:function(){t(CONFIG.url.report,function(){trackEvent("button","click","report")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_faq"),contexts:["browser_action"],parentId:"help",onclick:function(){t(CONFIG.url.faq,function(){trackEvent("button","click","faq")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_changelog"),contexts:["browser_action"],parentId:"help",onclick:function(){t(CONFIG.url.changelog,function(){trackEvent("button","click","changelog")})}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"help"}),e.contextMenus.create({title:"J2TEAM Community",contexts:["browser_action"],parentId:"help",onclick:function(){t("https://www.facebook.com/profile.php?id=364997627165697")}}),e.contextMenus.create({type:"separator",contexts:["browser_action"]}),e.contextMenus.create({title:e.i18n.getMessage("premiumAccess"),contexts:["browser_action"],id:"premium",onclick:function(){t(CONFIG.url.premium_login,function(){trackEvent("button","click","login_premium")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_donate"),contexts:["browser_action"],onclick:function(){t(CONFIG.url.donate,function(){trackEvent("button","click","donate")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_rate_me"),contexts:["browser_action"],onclick:function(){t(CONFIG.url.review,function(){trackEvent("button","click","rate")})}}),o({title:n("report_abuse"),id:"report_abuse"}),o({title:n("report_phishing"),parentId:"report_abuse",id:"report_phishing"}),o({title:n("report_badware"),parentId:"report_abuse",id:"report_badware"}),o({title:n("report_webspam"),parentId:"report_abuse",id:"report_webspam"}),e.contextMenus.onClicked.addListener(c),e.tabs.onActivated.addListener(function(){e.tabs.query({active:!0,highlighted:!0,currentWindow:!0},function(e){try{e[0]&&e[0].url&&r(e[0].url)}catch(t){_log(t.message,"error")}})}),e.tabs.onUpdated.addListener(function(e,t,n){"loading"===t.status&&r(t.url)}),e.tabs.onActivated.addListener(function(t){e.tabs.get(t.tabId,function(e){r(e.url)})}),e.contextMenus.create({contexts:["link","page"],id:"open_in_giamgiato",documentUrlPatterns:["https://shopee.vn/*"],targetUrlPatterns:["https://shopee.vn/*-i.*"],title:"Open in GiamGia.To",onclick:function(e){u(e.linkUrl?e.linkUrl:e.pageUrl)}})}(chrome,_TabCreateOrFocus),function(e){}(chrome);